<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>Modalitats - Un viatge musical i dansat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="estils.css">
</head>
<body>
  <!-- Panel lateral para mostrar temas seleccionados -->
  <div class="side-panel">
    <h3>Temes seleccionats</h3>
    <ul id="temesSeleccionats"></ul>
  </div>
  <div class="main-content">
    <div id="userEmail" class="user-email"></div>
    <div class="container center">
      <h2>Modalitats</h2>
      <form id="modalitatsForm">
        <div class="modalitats-options">
          <label><input type="checkbox" name="modalitat" value="teoria"> Teoria</label>
          <label><input type="checkbox" name="modalitat" value="terminologia"> Terminologia</label>
          <label><input type="checkbox" name="modalitat" value="audicions"> Audicions</label>
        </div>
        <div class="actions">
          <button type="submit">Començar</button>
        </div>
        <div id="error" class="error" style="display:none;"></div>
      </form>
    </div>
  </div>
  <!-- Scripts Firebase y tus JS -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="main.js"></script>
  <script>
    // Nombres de los temas (el mismo orden que en temes.html)
    const nomsTemes = [
      "Música de l’antiguitat",
      "Música Medieval",
      "Música del Renaixement",
      "Música del Barroc",
      "Música del Classicisme",
      "Música del Romanticisme",
      "Música del segle XX i últimes tendències",
      "Músiques urbanes (jazz, rock, blues, rap, electrònica)",
      "Música de pel·lícules i musicals",
      "Músiques i danses tradicionals del món",
      "Músiques i danses tradicionals de les Illes Balears",
      "Història de la dansa"
    ];

    function mostrarTemesSeleccionats() {
      let temes = [];
      try {
        temes = JSON.parse(localStorage.getItem('temesSeleccionats') || "[]");
      } catch(e) {}
      const ul = document.getElementById("temesSeleccionats");
      ul.innerHTML = temes.map(idx => `<li>${nomsTemes[parseInt(idx,10)-1]}</li>`).join('');
    }

    window.addEventListener('DOMContentLoaded', function() {
      mostrarTemesSeleccionats();
      if (typeof mostrarInfoUsuario === "function") mostrarInfoUsuario();

      // Manejar el envío del formulario para varias modalidades
      document.getElementById('modalitatsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const checkboxes = document.querySelectorAll('.modalitats-options input[type="checkbox"]:checked');
        const errorDiv = document.getElementById('error');
        if (checkboxes.length === 0) {
          errorDiv.textContent = 'Per favor, selecciona almenys una modalitat per continuar.';
          errorDiv.style.display = 'block';
          return;
        }
        errorDiv.style.display = 'none';
        const modalitatsSeleccionades = Array.from(checkboxes).map(cb => cb.value);
        // Guarda las modalidades seleccionadas en localStorage
        localStorage.setItem('modalitatsSeleccionades', JSON.stringify(modalitatsSeleccionades));
        // Redirige a la siguiente página o acción
        window.location.href = 'joc.html';
      });
    });
  </script>
</body>
</html>
